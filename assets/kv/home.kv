#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp

<HomeScreen>:
    MDScrollView:
        MDBoxLayout:
            orientation: "vertical"
            padding: dp(16)
            spacing: dp(16)
            size_hint_y: None
            height: self.minimum_height

            # -----------------------------------------
            #   B L O Q U E   1 — CARRUSEL
            # -----------------------------------------
            MDCard:
                radius: [20]
                elevation: 2
                size_hint_y: None
                height: dp(260)
                padding: 0

                Carousel:
                    id: photos_carousel
                    loop: True
                    direction: "right"

            # -----------------------------------------
            Widget:
                size_hint_y: None
                height: dp(12)

            # -----------------------------------------
            #   B L O Q U E   2 — DESAFÍO SEMANAL
            # -----------------------------------------
            MDCard:
                radius: [20]
                padding: dp(16)
                elevation: 2
                adaptive_height: True

                MDBoxLayout:
                    orientation: "vertical"
                    spacing: dp(8)
                    adaptive_height: True

                    MDBoxLayout:
                        spacing: dp(8)
                        adaptive_height: True

                        MDIcon:
                            icon: "trophy-outline"
                            size_hint: None, None
                            size: dp(36), dp(36)

                        MDBoxLayout:
                            orientation: "vertical"
                            adaptive_height: True

                            MDLabel:
                                text: root.weekly_title
                                font_size: sp(21)
                                bold: True
                                size_hint_y: None
                                height: self.texture_size[1]

                            MDLabel:
                                text: root.weekly_desc
                                theme_text_color: "Secondary"
                                font_size: sp(15)
                                size_hint_y: None
                                height: self.texture_size[1]

                    MDLinearProgressIndicator:
                        id: weekly_progress
                        value: root.progress_percent
                        size_hint_y: None
                        height: dp(12)

                    MDBoxLayout:
                        size_hint_y: None
                        height: dp(40)

                        MDLabel:
                            id: weekly_progress_label
                            text: root.progress_text
                            theme_text_color: "Secondary"

                        Widget:

                        MDButton:
                            style: "filled"
                            on_release: root.register_recycling()
                            MDButtonText:
                                text: "Registrar reciclaje"

            # -----------------------------------------
            Widget:
                size_hint_y: None
                height: dp(12)

            # -----------------------------------------
            #   B L O Q U E   3 — MÉTRICAS (GRID)
            # -----------------------------------------
            MDGridLayout:
                cols: 3 if self.width >= dp(480) else 2
                spacing: dp(12)
                size_hint_y: None
                height: self.minimum_height

                MetricCard:
                    icon: "recycle-variant"
                    title: "248"
                    subtitle: "Kg Reciclados"

                MetricCard:
                    icon: "leaf"
                    title: "1,540"
                    subtitle: "Puntos Verdes"

                MetricCard:
                    icon: "account-group"
                    title: "89"
                    subtitle: "Comunidad"
